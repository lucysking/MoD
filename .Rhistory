dplyr::select(
ID,
episode,
episode_duration,
valence_z,
arousal
) %>%
pivot_wider(
names_from = c(episode),
values_from = c(episode_duration:arousal)
) %>%
ungroup()
ad_corrr <-
ad_wf_EP %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_corrr
ad_wf_EP %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_all_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_E %>%
dplyr::select(valence_z_B:last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_E %>%
dplyr::select(valence_z_B: last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_mean_episode_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_EP %>%
dplyr::select(contains("Baseline")) %>%
dplyr::select(valence_z_Baseline_NSL: last_col()) %>%
correlate() %>%
shave() %>%
fashion()
file_origin <-
dir(
path = "/Volumes/group/active/MoD/Behavioral_Videos",
pattern = "^\\d{5}_\\d{8}$",
full.names = TRUE
)
file_destination <- "~/Desktop/MoD/MoD_private/data/coding_files/"
files <-
list.files(
path = file_origin,
pattern = "^\\d{5}_FilebyFrame_USE.csv$",
recursive = TRUE,
full.names = TRUE
)
file.copy(files, file_destination)
#Libraries
library(tidyverse)
library(psych)
library(ggpubr)
library(corrr)
library(ggcorrplot)
source("~/Desktop/MOD/MoD/winsorize.R")
#Files
affect_files  <-
tibble(
path =
list.files(
path = file_destination,
pattern = "^\\d{5}_FilebyFrame_USE.csv$",
full.names = TRUE
)
)
cbq_file <- paste0("~/Box/MOD/Data/REDCap/CBQ/cbq_cbqem_total_scores_20210322.csv")
cbbPalette <- c(
"#000000",
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"
)
affect_data <-
affect_files %>%
mutate(
data = map(path, ~read_csv(., col_types = cols(.default = "c")))
) %>%
unnest(data) %>%
mutate(
ID = str_extract(path, "\\d{5}")
)
affect_data_cl <-
affect_data %>%
mutate(
# merge variables with same meaning but different names
phase = case_when(
!is.na(episode_section.code01) ~ episode_section.code01,
!is.na(episode_segment.code01) ~ episode_segment.code01
),
phase.onset = case_when(
!is.na(episode_section.onset) ~ episode_section.onset,
!is.na(episode_segment.onset) ~ episode_segment.onset
),
phase.offset = case_when(
!is.na(episode_section.offset) ~ episode_section.offset,
!is.na(episode_segment.offset) ~ episode_segment.offset
)
) %>%
select(
id = ID,
episode = episode.code01,
episode.onset,
episode.offset,
phase,
phase.onset,
phase.offset,
arousal.onset,
arousal.offset,
arousal = arousal_s.code01,
valence.onset,
valence.offset,
valence = valence.code01,
valence_r.onset,
valence_r.offset,
valence_r = valence_r.code01,
-path
) %>%
mutate(
# use regex to extract tidy info for phase variable
phase = str_replace(phase, "^\\w+_", ""),
phase = str_replace(phase, "^\\w+\\r_", ""),
phase = str_replace(phase, "^\\w+\\r\\r_", ""),
arousal = str_replace(arousal, "^\\w+_\\w+-", ""),
# if missing arousal offset, use phase offset
arousal.offset = if_else(
is.na(arousal.offset) & !is.na(arousal), phase.offset, arousal.offset
),
# fix errors in data entry
arousal = case_when(
phase == "Baseline- 0" ~ str_replace(phase, "^\\w+-", ""),
phase == "Baseline- 0.5" ~ str_replace(phase, "^\\w+-", ""),
phase == "Baseline- 1.5" ~ str_replace(phase, "^\\w+-", ""),
phase == "Baseline- 2" ~ str_replace(phase, "^\\w+-", ""),
phase == "Recovery- 0" ~ str_replace(phase, "^\\w+-", ""),
phase == "Recovery- 1" ~ str_replace(phase, "^\\w+-", ""),
phase == "	Stressor- 1" ~ str_replace(phase, "^\\w+-", ""),
phase == "	Stressor- 0" ~ str_replace(phase, "^\\w+-", ""),
phase == "	Stressor- 2" ~ str_replace(phase, "^\\w+-", ""),
TRUE ~ arousal
),
phase = case_when(
phase == "Baseline- 0.5" ~ "Baseline",
phase == "Baseline- 1.5" ~ "Baseline",
phase == "Baseline- 0" ~ "Baseline",
phase == "Baseline- 2" ~ "Baseline",
phase == "Stresor" ~ "Stressor",
phase == "PC\n_Recovery" ~ "Recovery",
phase == "Stressor- 1" ~ "Stressor",
phase == "Stressor- 0" ~ "Stressor",
phase == "Stressor- 2" ~ "Stressor",
phase == "Recovery- 0" ~ "Recovery",
phase == "Recovery- 1" ~ "Recovery",
phase == "SM\n_Baseline" ~ "Baseline",
phase == "SM\n_Recovery" ~ "Recovery",
phase == "SM\n_Stressor" ~ "Stressor",
phase == "Basline" ~ "Baseline",
phase == "B\n_Baseline" ~ "Baseline",
TRUE ~ phase
)
) %>%
mutate_at(
vars(id, ends_with("set"), ends_with("_r"), valence, arousal),
as.double
) %>%
# remove data not nested within an episode or phase
# remove ID 10046 due to improper camera angle
filter(!is.na(episode), !is.na(phase), id != 10046)
affect_data_cl %>%
distinct(id)
affect_data_cl %>%
distinct(id, episode) %>%
count(episode)
affect_data_cl %>%
distinct(id, episode, phase) %>%
count(episode, phase)
valence_data <-
affect_data_cl %>%
mutate(
valence.onset = case_when(
is.na(valence.onset) & !is.na(valence_r.onset) ~ valence_r.onset,
!is.na(valence.onset) & is.na(valence_r.onset) ~ valence.onset,
TRUE ~ valence.onset
),
valence.offset = case_when(
is.na(valence.offset) & !is.na(valence_r.offset) ~ valence_r.offset,
!is.na(valence.offset) & is.na(valence_r.offset) ~ valence.offset,
TRUE ~ valence.offset
),
valence = case_when(
is.na(valence) & !is.na(valence_r) ~ valence_r,
!is.na(valence) & is.na(valence_r) ~ valence,
TRUE ~ valence
)
) %>%
select(
id,
episode,
phase,
phase.onset,
phase.offset,
valence.onset,
valence.offset,
valence
) %>%
group_by(id, episode, phase) %>%
mutate(
phase_dur = (phase.offset - phase.onset) / 1000,
valence_dur = (valence.offset - valence.onset) / 1000,
valence_prop = valence_dur / phase_dur
) %>%
ungroup() %>%
distinct(id, episode, phase, valence_dur, valence, valence_prop) %>%
group_by(id, episode, phase, valence) %>%
summarise(
prop = mean(valence_prop, na.rm = TRUE)
) %>%
ungroup()
valence_data <-
valence_data %>%
filter(valence != 999) %>%
mutate(
valence_product = prop * valence
) %>%
group_by(id, episode, phase) %>%
summarise(
valence = sum(valence_product, na.rm = TRUE)
) %>%
ungroup() %>%
mutate(
episode = fct_relevel(
episode,
"PC", "NSL", "B", "SM"
),
phase = fct_relevel(
phase,
"Baseline", "Stressor", "Recovery"
)
)
arousal_data <-
affect_data_cl %>%
filter(!is.na(arousal)) %>%
select(
id,
episode,
phase,
phase.onset,
phase.offset,
arousal
) %>%
distinct(id, episode, phase, .keep_all = TRUE)
ad <-
valence_data %>%
left_join(arousal_data, by = c("id", "episode", "phase")) %>%
mutate(
episode = factor(
episode,
levels = c("B", "PC", "NSL", "SM")
),
phase = factor(
phase,
levels = c("Baseline", "Stressor", "Recovery")
),
# standardize scores
valence_z = scale(valence, scale = TRUE),
arousal_z = scale(arousal, scale = TRUE),
phase_duration = (phase.offset - phase.onset) / 1000
)  %>%
group_by(id, episode) %>%
mutate(
episode_duration = sum(phase_duration, na.rm = TRUE)
) %>%
ungroup() %>%
dplyr::select(-phase.onset, -phase.offset)
ad %>%
ggplot(aes(phase_duration, fill = phase)) +
geom_histogram() +
facet_wrap(.~episode, scales = "free")
ad %>%
ggplot(aes(valence_z, fill = phase)) +
geom_histogram(binwidth = .25) +
facet_wrap(.~episode, scales = "free")
ad %>%
ggplot(aes(valence_z, fill = phase)) +
geom_density(alpha = 1/2) +
facet_wrap(.~episode, scales = "free")
ad %>%
ggplot(aes(arousal, fill = phase)) +
geom_histogram(binwidth = .5) +
facet_wrap(.~episode, scales = "free")
ad %>%
ggplot(aes(arousal, fill = phase)) +
geom_density(alpha = 1/2) +
facet_wrap(.~episode, scales = "free")
ad <-
ad %>%
mutate(
valence = winsorize(valence, product = 3),
valence_z = winsorize(valence_z, product = 3)
)
ad_wf_EP <-
ad %>%
dplyr::select(
id,
episode,
phase,
phase_duration,
episode_duration,
valence_z,
arousal_z
) %>%
pivot_wider(
names_from = c(episode, phase),
values_from = c(phase_duration:arousal_z)
)
ad_wf_E <-
ad %>%
group_by(id, episode) %>%
summarise_at(
vars(valence:last_col()),
funs(mean), na.rm = TRUE
) %>%
dplyr::select(
id,
episode,
episode_duration,
valence_z,
arousal
) %>%
pivot_wider(
names_from = c(episode),
values_from = c(episode_duration:arousal)
) %>%
ungroup()
ad_corrr <-
ad_wf_EP %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_corrr
ad_wf_EP %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_all_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_E %>%
dplyr::select(valence_z_B:last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_E %>%
dplyr::select(valence_z_B: last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_mean_episode_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_EP %>%
dplyr::select(contains("Baseline")) %>%
dplyr::select(valence_z_Baseline_NSL: last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_E %>%
left_join(read_csv(cbq_file), by = "id")
cbq_file <- paste0("~/Box/Mooddata_Coordinating/MOD/Data/REDCap/CBQ/cbq_cbqem_total_scores_20210322.csv")
ad_wf_E %>%
left_join(read_csv(cbq_file), by = "id")
dplyr::select(valence_z_B:last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_E %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_B:last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_cbq_all_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_E %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_B:last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_cbq_all_corr.png",
dpi = 500,
height = 6,
width = 8.5
)
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_B:last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_EP %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
left_join(read_csv(cbq_file), by = "id") %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_NSL_Baseline: last_col()) %>%
rename_at(
vars(contains("_z_")),
funs(str_replace(., "_z_", "_"))
) %>%
na.omit() %>%
cor() %>%
ggcorrplot(outline.color = "white", type = "lower")
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_cbq_all_corr.png",
dpi = 500,
height = 8,
width = 10
)
ggsave(
"~/Box/lucy_king_files/MoD/temperament/figures/labtab_cbq_all_corr.png",
dpi = 500,
height = 10,
width = 12
)
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id")
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_NSL_Baseline: arousal_z_SM_Stressor, cbq_negativeaff) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
dplyr::select(valence_z_NSL_Baseline: arousal_z_SM_Stressor, cbq_negativeaff) %>%
correlate() %>%
shave() %>%
fashion()
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
ggplot(aes(cbq_negativeaff, valence_z_NSL_Recovery)) +
geom_point()
ad_wf_EP %>%
left_join(read_csv(cbq_file), by = "id") %>%
ggplot(aes(cbq_negativeaff, valence_z_NSL_Recovery)) +
geom_point() +
geom_smooth(method = "lm")
